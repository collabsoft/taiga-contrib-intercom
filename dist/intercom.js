(function(){var IntercomDirective,module;IntercomDirective=function($config,$analytics){var initialized,link,patchAnalytics,refreshUser;return initialized=!1,refreshUser=function(user){return user?window.Intercom("boot",{app_id:$config.get("intercomApiKey"),email:user.email,user_id:user.id,created_at:user.date_joined,analytics_id:user.uuid}):window.Intercom("boot",{app_id:$config.get("intercomApiKey")})},patchAnalytics=function(){var trackEvent,trackPage;return trackPage=$analytics.trackPage.bind($analytics),$analytics.trackPage=function(url,title){if(trackPage(url,title),initialized&&window.Intercom)return window.Intercom("trackEvent","pageview",{url:url,title:title})},trackEvent=$analytics.trackEvent.bind($analytics),$analytics.trackEvent=function(category,action,label,value){if(trackEvent(category,action,label,value),initialized&&window.Intercom)return window.Intercom("trackEvent",category+" "+action,{category:category,action:action,label:label,value:value})}},link=function($scope,$el,$attrs){return patchAnalytics($analytics),$scope.$on("auth:login",refreshUser),$scope.$on("auth:logout",refreshUser),$scope.$on("auth:register",refreshUser),$scope.$on("auth:refresh",refreshUser),$scope.$on("loader:end",function(){var i,s,x;if(!initialized)return initialized=!0,"function"==typeof window.Intercom?(window.Intercom("reattach_activator"),window.Intercom("update",intercomSettings)):(i=function(){return i.c(arguments)},i.q=[],i.c=function(args){return i.q.push(args)},window.Intercom=i,s=document.createElement("script"),s.type="text/javascript",s.async=!0,s.src="https://widget.intercom.io/widget/"+$config.get("intercomApiKey"),x=document.getElementsByTagName("script")[0],x.parentNode.insertBefore(s,x)),refreshUser($scope.user)})},{restrict:"E",link:link}},module=angular.module("intercomPlugin",[]),module.directive("body",["$tgConfig","$tgAnalytics",IntercomDirective])}).call(this);